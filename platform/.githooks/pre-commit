#!/usr/bin/env bash
set -euo pipefail
platform/scripts/guard-big-files.sh

# Block artifacts accidentally staged

if git diff --cached --name-only | grep -E '(^|/)(node_modules|dist|build|.next|coverage|.expo)/' >/dev/null; then
echo "ERROR: Build artifacts staged. Update .gitignore if needed." >&2
exit 1
fi

# Block env/secrets

if git diff --cached --name-only | grep -E '(^|/).env(.|$)|(^|/).secrets|(^|/)platform/.secrets_quarantine/' >/dev/null; then
echo "ERROR: Secrets detected in staging area." >&2
exit 1
fi